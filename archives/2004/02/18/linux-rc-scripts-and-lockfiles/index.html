<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Linux rc scripts and lockfiles &middot; PapaScott
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/ps.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed/index.xml">

</head>


  <body class="theme-base-08" >

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><a href="/">PapaScott</a> is a personal weblog by Scott Hanson.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about.html">About</a>
        
      
    
      
    
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/search.html">Search</a>
        
      
    
      
        
      
    
    
<div class="sidebar-nav-item">Archives: 

<a href="/archives/2015/">2015</a>
<a href="/archives/2014/">2014</a>
<a href="/archives/2013/">2013</a>
<a href="/archives/2012/">2012</a>
<a href="/archives/2011/">2011</a>
<a href="/archives/2010/">2010</a>
<a href="/archives/2009/">2009</a>
<a href="/archives/2008/">2008</a>
<a href="/archives/2007/">2007</a>
<a href="/archives/2006/">2006</a>
<a href="/archives/2005/">2005</a>
<a href="/archives/2004/">2004</a>
<a href="/archives/2003/">2003</a>
<a href="/archives/2002/">2002</a>
<a href="/archives/2001/">2001</a>
<a href="/archives/2000/">2000</a>
<a href="/archives/1999/">1999</a>

</div>
    <a class="sidebar-nav-item" href="http://www.mcdonalds-nordheide.de/">McDonald's Nordheide-Harburg</a>


    
</nav>
  <div class="sidebar-item">
  <p>
  	Powered by <a href="http://jekyllrb.com/">jekyll</a>, styled by <a href="http://lanyon.getpoole.com/">lanyon</a>, served by <a href="https://pages.github.com/">GitHub</a>
  </p>
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">PapaScott</a>
            <small>And you know what they said? Well, some of it was true!</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        

        <div class="post">
  <h1 class="post-title">Linux rc scripts and lockfiles</h1>
  <span class="post-date">18 Feb 2004</span>
  <p>When I powered down one of our Notes servers running Linux last month to replace a bad drive in the RAID, I noticed that Notes was not powered down cleanly, even though we the stop script correctly set up under /etc/rc.d. Our Notes admins have various log rotation and safety commands in their server scripts, so they very much prefer that the server be powered down correctly. I couldn't for the life of me figure out what was wrong. The server started just fine on power up, calling the script on the command line worked just fine, but doing an actual shutdown seem to skip over the stop script completely.<br />
<!--more--><br />
I'm now setting up a new Notes server, and took the chance to figure out what's going wrong before it goes online. After about 20 tries, I finally saw the light. We had copied the start/stop script from a Solaris machine. It simply called "server start", "sever stop", or "server kill". Linux (at least Mandrake and Red Hat), however, keep lock files for their services under /var/lock/subsys. When /etc/rc.d/rc is called for a change in run level, it does not run the stop script if the lockfile does not exist. Therefore, our stop script for Notes was never called.</p>
<p>We never noticed this before since we don't have that many homemade services, and none of them ever complained when they were killed rather than shut down. And Linux servers don't need to be shut down that often. The problem doesn't seem to be that obvious; doing some Googling, I was unable to find any advice that rc scripts under Linux <em>must</em> use lock files in order to be called correctly.</p>
<p>In our case of Notes, the use of lock files is inconvenient at best. Our Notes server processes run as user 'notes' rather than root, and our Notes admins log in as 'notes' to do server maintainance. However 'notes' is unable to write to the lock directory, so the lock directory may correctly reflect the status of the Notes processes. But for now, we're just happy that our Notes log files no longer get blown away by a system reboot.</p>

</div>
<div>
  
    <span class="post-date">
    Previous Post: <a href="/archives/2004/02/18/transblawg-thanks-to-a-semicolon-gays-and-lesbians-keep-marrying-in-san-francisco/">Transblawg: Thanks to a semicolon, gays and lesbians keep marrying in San Francisco</a></span>
  
  
    <span class="post-date">
    Next Post: <a href="/archives/2004/02/18/davids-medienkritik-german-american-friendship-in-huntsville-alabama/">Davids Medienkritik: German-American friendship in Huntsville, Alabama</a></span>
  
</div>
<div class="related">
  <h2>Recent Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/archives/2015/04/23/transition/">
            Transition
            <small>23 Apr 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/archives/2015/04/20/confirmation/">
            Confirmation
            <small>20 Apr 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/archives/2015/02/10/how-i-punked-facebook/">
            How I Punked Facebook
            <small>10 Feb 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

        
<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
if(location.hostname.match('papascott')){
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'papascott'; // required: replace example with your forum shortname
  var disqus_identifier = "/archives/2004/02/18/linux-rc-scripts-and-lockfiles/";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  }
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Creating an MT Import File from HTML &middot; PapaScott
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/ps.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed/index.xml">

</head>


  <body class="theme-base-08" >

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><a href="/">PapaScott</a> is a personal weblog by Scott Hanson.</p>
  </div>
<!-- Jquery loads content of sidebar div, see default.html -->
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">PapaScott</a>
            <small>And you know what they said? Well, some of it was true!</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        

        <div class="post">
  <h1 class="post-title">Creating an MT Import File from HTML</h1>
  <span class="post-date">23 Dec 2002</span>
  <p><a href="http://www.couchblog.de/couchblog/">Nico</a> recently trashed his Movable Type database. He had a backup, but it was old (from October), so he was missing about 200 entries. Knowing that I had trashed my database once or twice, he asked me for advice. </p>
<p>200 entries is a bit too much to copy and paste, so I came up with a little perl script to create a <a href="http://www.movabletype.org/docs/mtimport.html">MT import file</a> from the HTML files of his individual entries. It's customized for Nico's template, but it might be a useful starting point for others stuck in the same situation.<br />
<!--more--><br />
Nico's template was something like this:<br />
&lt;div&gt;&lt;h3&gt;Title&lt;/h3&gt;<br />
Post<br />
&lt;a name="more"&gt;<br />
More post<br />
&lt;/div&gt;</p>
<p>So I was able to look for the title between the h3 tags, the body of the post between the title and the 'more' anchor, the extended entry between the more anchor and the closing div tag, and so on. The category wasn't included, so I had to skip it. You'll need to adjust this logic to fit your template.</p>
<p>The perl is pretty basic. I'm using 'slurp mode' to read in the entire HTML file into a variable, instead of reading the file line by line.  I'm also in the habit of using | to delimit my regex, so they look like m|...| instead of the typical /.../. And when you return a regex in a list context, you get a list of the matches $1, $2, etc. So instead of '$content =~ m|...|;$author=$1;', I can put this one a single line as '($author) =($content =~ m|...|);'.</p>
<p><code>#!/usr/bin/perl<br />
# parse.pl - parse HTML files to import into Movable Type<br />
# usage: parse.pl *html &gt; output.txt<br />
# Note: you _will_ need to adjust the regex and date conversion<br />
while (&lt;&gt;) { # for each file on the command line<br />
# read in entire file to $content, line feeds and all<br />
# using slurp mode<br />
    { local $/; $content = &lt;&gt;;}<br />
# locate the fields we need using regex<br />
# some matches may include newlines<br />
    ($author) =($content =~ m|&lt;div class="posted"&gt;s+(.+?)s+/|s);<br />
    ($title) = ($content =~ m|&lt;h3 class="title"&gt;(.+)&lt;/h3&gt;|);<br />
    ($text) =  ($content =~ m|&lt;/h3&gt;s+(.+)s+&lt;a name="more"&gt;|s);<br />
    ($more) =  ($content =~ m|&lt;a name="more"&gt;s+(.+)s+&lt;/div&gt;|s);<br />
    ($date) =  ($content =~ m|title="updated: (.+)" name="updated"|);<br />
# convert the date to MM/DD/YYYY hh:mm:ss<br />
    $date =~ s|([-d])02|${1}2002|;<br />
    $date =~ tr|-,|/|d;<br />
# printout the fields in the proper format<br />
    print "AUTHOR: $authorn";<br />
    print "TITLE: $titlen";<br />
    print "DATE: $date:00n";<br />
    print "-----n";<br />
    print "BODY:n$textn";<br />
    print "-----n";<br />
    print "EXTENDED BODY:n$moren";<br />
    print "</code></p>

</div>
<div>
  
    <span class="post-date">
    Previous Post: <a href="/archives/2002/12/23/shopping-list/">Shopping List</a></span>
  
  
    <span class="post-date">
    Next Post: <a href="/archives/2002/12/23/christmas-garlic/">Christmas Garlic</a></span>
  
</div>
<div class="related" id="related">
<!-- Jquery loads content of related div, see default.html -->
</div>

        
<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
if(location.hostname.match('papascott')){
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'papascott'; // required: replace example with your forum shortname
  var disqus_identifier = "/archives/2002/12/23/creating-an-mt-import-file-from-html/";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  }
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>
      $( "#sidebar" ).load( "/includes/sidebar.html" );
      $( "#related" ).load( "/includes/related.html" );
    </script>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>

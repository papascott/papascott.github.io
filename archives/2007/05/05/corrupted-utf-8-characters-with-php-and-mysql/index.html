<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Corrupted UTF-8 characters with PHP and MySQL &middot; PapaScott
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/ps.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed/index.xml">

</head>


  <body class="theme-base-08" >

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><a href="/">PapaScott</a> is a personal weblog by Scott Hanson.</p>
  </div>
<!-- Jquery loads content of sidebar div, see default.html -->
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">PapaScott</a>
            <small>And you know what they said? Well, some of it was true!</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        

        <div class="post">
  <h1 class="post-title">Corrupted UTF-8 characters with PHP and MySQL</h1>
  <span class="post-date">05 May 2007</span>
  <p>Someone recently asked me about corrupted characters in a PHP-MySQL project. They had recent stable versions of everything, MySQL 5.0 and PHP 5.1, using UTF-8 for everything, and they were getting corrupted accented characters saved in the database, junk with 'Ã's was coming out. They were asking me if there were perhaps some secret PHP setting they were missing to make things right. Not that I knew of.</p>
<p>I would have thought that in this day and age using UTF-8 with PHP and MySQL would just work. To try this out for myself, I downloaded some simple tutorial code, set up databases and HTML with UTF-8, and started creating records with names like Scött Hänsön and Mäcky Möüße. And sure enough, I got junk.</p>
<p>PHP and MySQL don't just work with UTF-8. In particular, the client connection from PHP to MySQL defaults to latin1. There don't seem to be any PHP settings to change this. On the MySQL side there are 'default-character-set' settings you can put in various sections of the my.cnf, but for me they didn't seem to help.</p>
<p>I found two ways to solve the problem. The first is to issue a <code>mysql_query("SET NAMES 'utf8')</code> immediately after every <code>mysql_connect</code> to manually switch the connection to utf8. That's a huge pain if you have a lot of code (even in my mini 5-file test-case I forgot one instance at first).</p>
<p>The other is to add a <code>init-connect='SET NAMES utf8'</code> setting to the <code>[mysqld]</code> section of my.cnf. <code>init-connect</code> automatically executes SQL commands at the beginning of every client connection. The catch is the commands won't be executed for a user with SUPER privileges, so if you're lazy and using 'root' to connect to your database, it won't work.</p>
<p>By using various combinations of <code>&lt;meta charset="blah"/&gt;</code> in the HTML and <code>SET NAMES</code> for the database connection, you can create interesting errors. The 'Ã' errors seem to occur when correctly sent utf-8 is incorrectly saved over a latin1 connection, then read back out as utf-8. My friend said he was using <code>SET NAMES 'utf8'</code> with all his connects, I'm guessing he forgot it for INSERTs and UPDATEs. That's just a hunch.</p>
<p>I wasn't able to find a clear explanation of this in Google (the closest was in the comments to <a href="http://www.php.net/manual/en/function.mysql-client-encoding.php">mysql&#95;client&#95;encoding()</a> in the PHP documentation), so I thought write this up here. It's clear to me, at least.</p>

</div>
<div>
  
    <span class="post-date">
    Previous Post: <a href="/archives/2007/05/03/top-7-things-system-administrators-forget-to-do/">Top 7 Things System Administrators Forget to Do</a></span>
  
  
    <span class="post-date">
    Next Post: <a href="/archives/2007/05/07/background-on-mccafe/"></a></span>
  
</div>
<div class="related" id="related">
<!-- Jquery loads content of related div, see default.html -->
</div>

        
<!-- Add Disqus comments. -->
<div id="disqus_thread"></div>
<script type="text/javascript">
if(location.hostname.match('papascott')){
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'papascott'; // required: replace example with your forum shortname
  var disqus_identifier = "/archives/2007/05/05/corrupted-utf-8-characters-with-php-and-mysql/";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  }
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.4/zepto.min.js"></script>
    <script>
      $( "#sidebar" ).load( "/includes/sidebar/index.html" );
      $( "#related" ).load( "/includes/related/index.html" );
    </script>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
